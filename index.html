<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quyết Định Công Tác</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: Tahoma, Arial, sans-serif;
      font-size: 13px;
      color: #000;
      background-color: #fff;
      padding: 20px;
    }
    h2, h3, h4 {
      text-align: center;
      margin: 4px 0;
      font-weight: bold;
    }
    .form-container {
      max-width: 850px;
      margin: auto;
      border: 1px solid #ccc;
      padding: 20px;
      background-color: #fff;
    }
    .form-grid, .route-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-bottom: 10px;
      align-items: center;
    }
    .form-grid label,
    .route-grid label {
      font-weight: bold;
      margin-bottom: 2px;
    }
    input, select, textarea {
      font-size: 13px;
      padding: 4px 6px;
      width: 100%;
      box-sizing: border-box;
    }
    .route {
      border: 2px dashed #2e7d32;
      padding: 12px;
      margin-bottom: 10px;
      background-color: #e6f4ea;
      border-radius: 8px;
    }
    .sub-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 4px 6px;
      text-align: center;
      font-size: 13px;
    }
    button {
      padding: 6px 12px;
      font-size: 13px;
      margin-top: 10px;
    }
  </style>
  <script>
    let routeCount = 1;

    function calculateDays() {
      const routes = document.querySelectorAll('.route');
      let totalDays = 0;
      routes.forEach(route => {
        const start = route.querySelector('[name^="depart-"]').value;
        const end = route.querySelector('[name^="return-"]').value;
        const dayBox = route.querySelector('.day-count');
        if (start && end) {
          const startDate = new Date(start);
          const endDate = new Date(end);
          const diffTime = endDate - startDate;
          const days = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
          if (days > 0) {
            totalDays += days;
            if (dayBox) dayBox.value = days;
          }
        }
      });
      document.getElementById('total-days').innerText = totalDays;
    }

    function calculateCosts() {
      let total = 0;
      const rows = document.querySelectorAll('table tbody tr');
      rows.forEach(row => {
        const qty = row.querySelector('input[data-role="qty"]');
        const price = row.querySelector('input[data-role="price"]');
        const totalCell = row.querySelector('input[data-role="subtotal"]');
        if (qty && price && totalCell) {
          const subtotal = parseInt(qty.value || 0) * parseInt(price.value || 0);
          totalCell.value = subtotal;
          total += subtotal;
        }
      });
      document.getElementById('total-cost').innerText = total.toLocaleString('vi-VN');
    }

    function addRoute() {
      routeCount++;
      const newDiv = document.createElement('div');
      newDiv.className = 'route';
      newDiv.innerHTML = `
        <h4>Lộ trình ${routeCount}</h4>
        <div class="route-grid">
          <label>Lộ trình:</label>
          <select name="route-name-${routeCount}" required>
            <option value="Bac Ninh - HAN">Bac Ninh - HAN</option>
            <option value="Da Nang - SGN">Da Nang - SGN</option>
            <option value="HCM - Ha Long">HCM - Ha Long</option>
          </select>

          <label>Phương tiện:</label>
          <select name="transport-${routeCount}" required>
            <option value="Xe khách">Xe khách</option>
            <option value="Máy bay">Máy bay</option>
            <option value="Tàu hỏa">Tàu hỏa</option>
            <option value="Xe công ty">Xe công ty</option>
          </select>

          <label>Giờ đi:</label>
          <input type="time" name="depart-time-${routeCount}" required>

          <label>Ngày đi:</label>
          <input type="date" name="depart-${routeCount}" required>

          <label>Giờ về:</label>
          <input type="time" name="return-time-${routeCount}" required>

          <label>Ngày về:</label>
          <input type="date" name="return-${routeCount}" required>

          <label>Số ngày công tác:</label>
          <input type="number" class="day-count" name="days-${routeCount}" readonly>
        </div>`;
      document.getElementById('routes').appendChild(newDiv);
    }

    document.addEventListener('input', () => {
      calculateDays();
      calculateCosts();
    });

    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('add-route').addEventListener('click', addRoute);
      calculateCosts();
    });
  </script>
</head>
<body>
<!-- Phần thân form giữ nguyên -->
</body>
</html>
